---
layout: post
title: "Was sind “Hash-Bang” (#!) URLs und worum geht es da?"
date: 2011-07-24 23:34
author: robert.muehsig
comments: true
categories: [Allgemein]
tags: [Browser, History, HTML5, Javascript]
language: de
---
{% include JB/setup %}
<p>Der Begriff “Hash-Bang” klingt irgendwie etwas blöd, aber es ist im Grunde nur die “Lautschrift” von einer Raute und einem Ausrufezeichen - im englischen: “#!”. Der Begriff kam auf, <a href="http://www.theawl.com/2011/02/what-a-hash-understanding-gawkers-redesign-and-hashbang-urls">als einige Internetseiten anfingen</a> anstatt “normale” URLs zu verwenden eine Adresse mit “#!” vorkam (z.B. <a href="http://lifehacker.com/#!5753509/hello-world-this-is-the-new-lifehacker">http://lifehacker.com/#!5753509/hello-world-this-is-the-new-lifehacker</a>). Wichtig ist das “#!”. Eine “ganz normale” URL sieht z.B. so aus: <a href="http://www.google.com/search?q=hello+world">http://www.google.com/search?q=hello+world</a>.</p> <p>Eine <a href="http://en.wikipedia.org/wiki/Uniform_Resource_Locator">URL</a> besteht aus mehreren Teilen, z.B. die Domain und der Pfad und am Ende noch ein Parameter. Der oder die Parameter werden durch ein führendes Fragezeichen “?=” vom Rest der URL getrennt. Ganz normal halt. </p> <p><strong>Das Problem kam mit AJAX</strong></p> <p>Es gibt ein paar Probleme bei AJAX Anwendungen. Durch Javascript und die geladenen Daten kann man sehr einfach die DOM verändern. Dadurch lassen sich sehr dynamische Seiten erstellen, jedoch ändert sich die URL dabei nicht! Für den Browser befindet man sich immer noch auf der selben Seite, egal wie viele AJAX Requests man gemacht hat. </p> <p><u>Nun begegnen wir ein paar Problemen:</u></p> <p>- Die Browser Navigation ist “ausgeschaltet”. Prominentes Beispiel hier ist der Back-Button des Browsers. Da sich die Browser-History nicht geändert hat, springt der Browser einfach auf die letzte Seite die er kennt. Dabei kann der Nutzer allerdings auf eine komplett andere Seite geleitet werden, obwohl er “nur” ein Schritt zurück gehen wollte.</p> <p>- Ohne bestimmte URL kann man auch keine Links verschicken. Je nach Anwendung kann das mehr oder weniger schlimm sein. </p> <p>- SEO ist auch noch ein Thema für sich. Javascript/AJAX und Suchmaschinen mögen sich nicht sonderlich und wenn man alles unter einer Adresse laufen hat, wird es wahrscheinlich nix mit dem Besucherstrom von Google. Auch hierbei ist natürlich die Frage ob SEO wichtig ist oder nicht.</p> <p>Ein Beispiel wo jedenfalls die ersten beiden Probleme auftreten ist Google Maps. Man startet bei “http://maps.google.com” und egal ob ich ran oder wegzoome, die URL ändert sich nicht.</p> <p><a href="{{BASE_PATH}}/assets/wp-images-de/image1296.png"><img style="background-image: none; border-bottom: 0px; border-left: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px" title="image" border="0" alt="image" src="{{BASE_PATH}}/assets/wp-images-de/image_thumb478.png" width="578" height="327"></a></p> <p>&nbsp;</p> <p>Keine Änderungen in der URL beim Zoomen:</p> <p><a href="{{BASE_PATH}}/assets/wp-images-de/image1297.png"><img style="background-image: none; border-bottom: 0px; border-left: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px" title="image" border="0" alt="image" src="{{BASE_PATH}}/assets/wp-images-de/image_thumb479.png" width="616" height="420"></a></p> <p>Nun geht natürlich auch der Browser-Back Button nicht und man kann nicht einfach den Link aus der Adresszeile kopieren. Google ist natürlich nicht doof: Natürlich haben sie einen Mechanismus eingebaut um den Ausschnitt als Link zu verschicken, jedoch über Umwege.</p> <p><strong>Wo liegt das Problem?</strong></p> <p>Über AJAX bzw. Javascript können wir die DOM ohne Probleme weitestgehend verändern, jedoch nicht elegant die URL ändern. Es gibt natürlich einen unschönen Weg:</p> <div style="padding-bottom: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; float: none; padding-top: 0px" id="scid:812469c5-0cb0-4c63-8c15-c81123a09de7:06cec6f1-038a-430e-81e3-a19a18c79cdc" class="wlWriterEditableSmartContent"><pre name="code" class="c#">&lt;script type="text/javascript"&gt;
     location.href='http://www.code-inside.de';
&lt;/script&gt; </pre></div>
<p>&nbsp;</p>


<p>Hierbei wird allerdings <strong>ein kompletter Page-Reload ausgelöst</strong> – das würde in AJAX Anwendungen keinen Sinn machen. Es gibt allerdings eine Ausnahme. Der Anker (oder das URL Fragment nach der “#”) kann verändert werden ohne das ein Page-Reload ausgelöst wird:</p>
<p><strong>Die Ausnahme: Der Anker ( # )</strong></p>
<p>Bekannt ist der Anker bei einem A-Tag. Man kann den Browser veranlassen zu einer bestimmten Stelle zu gehen. Dieser Teil ist nach dem # (Hash) aufgeführt.</p>
<p><a href="{{BASE_PATH}}/assets/wp-images-de/image1298.png"><img style="background-image: none; border-bottom: 0px; border-left: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px" title="image" border="0" alt="image" src="{{BASE_PATH}}/assets/wp-images-de/image_thumb480.png" width="441" height="168"></a></p>
<p>Der Anker kann auch via Javascript aufgerufen werden:</p>
<div style="padding-bottom: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; float: none; padding-top: 0px" id="scid:812469c5-0cb0-4c63-8c15-c81123a09de7:06a31111-d543-4052-878b-e7eadab27dfc" class="wlWriterEditableSmartContent"><pre name="code" class="c#">window.location.hash="HelloWorld"; </pre></div>
<p>&nbsp;</p>
<p>Dabei wird <strong>kein</strong> Page-Reload ausgeführt! Die Browser-Navigation funktioniert auch (Browser-Back Button) und man kann auch die Links verschicken.</p>
<p><strong>Dann wird es jedoch etwas knifflig…</strong></p>
<p>Wenn wir die Probleme von oben beseitigen wollen, müssen wir über diesen Umweg die History bearbeiten. Wenn man diesen Weg einschlägt um die Browser History wieder zu kitten bekommt man natürlich gleich neue Probleme: Was passiert wenn jemand den Link verschickt? Nehmen wir das Beispiel Google Maps: Wenn ich dem Nutzer anbiete den Link zu verschicken muss ich natürlich darauf auch wieder reagieren. Das kann doch zu einem recht großes K(r)ampfgebiet werden.</p>
<p>Diese Problemstellungen tauchen am meisten bei <a href="http://en.wikipedia.org/wiki/Single-page_application">Single-Page-Apps</a> auf. D.h. am Anfang gibt es einen großen Page-Load und der Rest wird via AJAX gemacht.</p>
<p><strong>Nun zu den Hash-Bangs</strong></p>
<p>Zu der ursprünglichen Frage: Hash-Bang URLs sind aus der Not geboren um die URL via Javascript auch zu verändern. Damit hat man auch in AJAX Anwendungen volle Kontrolle und man beseitig die beschriebenen Probleme. Ein bekannter Vertreter ist z.B. Twitter:</p>
<p><a href="{{BASE_PATH}}/assets/wp-images-de/image1299.png"><img style="background-image: none; border-bottom: 0px; border-left: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px" title="image" border="0" alt="image" src="{{BASE_PATH}}/assets/wp-images-de/image_thumb481.png" width="497" height="226"></a></p>
<p>Es gab vor einiger Zeit eine Diskussion ob diese Art der URLs <a href="http://mtrpcic.net/2011/02/fragment-uris-theyre-not-as-bad-as-you-think-really/">gut</a> oder <a href="http://isolani.co.uk/blog/javascript/BreakingTheWebWithHashBangs">schlecht</a> sind, allerdings ist die Rettung in Sicht:</p>
<p><strong>Die</strong> <a href="https://developer.mozilla.org/en/DOM/Manipulating_the_browser_history"><strong>PushState API</strong></a><strong>! </strong></p>
<p>Durch diese API kann man die URL via Javascript ändern – funktioniert leider nur in modernen Browsern. Aber auch hier gibt es schon ein bekannten Vertreter: <a href="https://github.com/">GitHub</a> (wenn man sich durch einen Source Tree navigiert).<strong> </strong></p>
<p><strong>Javascript Frameworks</strong></p>
<p>Für beide Arten (die Hash-Variante) und die PushState API gibt es bereits Frameworks, sodass man damit leichter arbeiten kann. Zum Teil wird auch geprüft ob der Browser die PushState API hat oder nicht und als FallBack wird die “alte” Variante genommen:</p>
<p>- <a href="http://documentcloud.github.com/backbone/#History">Backbone.js</a></p>
<p>- <a href="http://plugins.jquery.com/project/history-js">History.js</a></p>
<p>- <a href="http://benalman.com/projects/jquery-bbq-plugin/">jQuery BBQ</a></p>
<p>- …</p>
<p>Auf meinem ToDo Zettel steht auch eine Demo-Anwendung mit Backbone.js – daher passt dieser Blogpost auch ganz gut in diese Reihe <img style="border-bottom-style: none; border-right-style: none; border-top-style: none; border-left-style: none" class="wlEmoticon wlEmoticon-winkingsmile" alt="Zwinkerndes Smiley" src="{{BASE_PATH}}/assets/wp-images-de/wlEmoticon-winkingsmile5.png"></p>
