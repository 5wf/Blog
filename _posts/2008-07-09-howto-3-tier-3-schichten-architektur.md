---
layout: post
title: "HowTo: 3-Tier / 3-Schichten Architektur"
date: 2008-07-09 21:38
author: robert.muehsig
comments: true
categories: [HowTo]
tags: [3-Schichten, 3-Tier, Architektur, HowTo, Unit Tests]
---
{% include JB/setup %}
<p>Eine 3-schichtige Architektur ist eigentlich ein "<a href="http://de.wikipedia.org/wiki/Schichtenmodell#F.C3.BCnf-Schichten-Architektur">Klassiker</a>" in der Softwareentwicklung. Da allerdings das Thema sehr weitläufig ist und Anfänger (und unbelehrbare Entwickler) aus Mangel an Zeit, Lust oder Erfahrung zurückschrecken gibt es genügend Beispiele wo einfach darauf verzichtet wurde.</p> <p>Um den <strong>Grundgedanken</strong> zu vermitteln und um zu zeigen, dass es eigentlich sehr einfach ist, sowas am Projektanfang zu implementieren, schreibe ich diesen Artikel</p> <p><strong>Was für "Schichten" und warum 3?<br></strong>Fast jede Software greift auf Daten zurück - sei es XML, ein Webservice, eine Datenbank, eine Textdatei oder ein X-beliebiges anderes System. <br>Diese Daten werden irgendwie verarbeitet - sei es eine mathematische Funktion, eine Validierung oder eine bestimmte Filter und Suchfunktion. <br>Damit das Ergebnis auch irgendwo angezeigt wird (bzw. die Eingaben entgegen genommen werden) gibt es in den meisten Fällen auch ein Frontend, sei es eine Consolen-Applikation, eine Website oder irgend etwas anderes.</p> <p>Jetzt wären wir bei den 3-Schichten angekommen:<br>&nbsp;<a href="{{BASE_PATH}}/assets/wp-images/image475.png"><img style="border-right: 0px; border-top: 0px; border-left: 0px; border-bottom: 0px" height="164" alt="image" src="{{BASE_PATH}}/assets/wp-images/image-thumb454.png" width="335" border="0"></a>  </p> <p><strong>"Nur 3? Ich hab mehr!"<br></strong>Natürlich kann man unzählige Schichten noch dazwischen schieben. Ein Beispiel ist z.B. die <a href="http://code-inside.de/blog/2007/10/24/howto-serie-servicefactory/">Software Factory</a> von Microsoft. Da gibt es noch etliche Mappings zwischen den Data-Access-Schichten bis hin zu den Service-Schichten. Siehe auch den Wiki-Artikel zu den <a href="http://de.wikipedia.org/wiki/Schichtenmodell#F.C3.BCnf-Schichten-Architektur">Schichtenmodellen</a>.</p> <p><strong>"Ich frage nur Daten ab - ich brauch nur 2 Schichten."<br></strong>Über SQL etc. kann man natürlich auch Filtern, Sortieren etc. - da könnte man auch die "Business" Schicht in Frage stellen. Aus meiner Erfahrung sollte man das allerdings lieber nicht machen - später können noch irgendwelche Anforderung dazukommen, die nix im Data Access Layer zu suchen haben. Bis es soweit ist, könnte die Business-Schicht die Daten einfach nur "durchreichen".</p><strong></strong> <p><strong>Beispielapplikation:<br><a href="{{BASE_PATH}}/assets/wp-images/image476.png"><img style="border-right: 0px; border-top: 0px; border-left: 0px; border-bottom: 0px" height="140" alt="image" src="{{BASE_PATH}}/assets/wp-images/image-thumb455.png" width="208" border="0"></a> </strong></p> <p>Data-Access Layer: "ThreeTier.Data"<br>Business Layer: "ThreeTier.Service"<br>Presentation Layer: "ThreeTier.ConsoleApp"<br>+ Unit-Tests: "ThreeTier.Tests"</p> <p>Hier haben wir eine recht einfache Beispielapplikation - das ganze noch mit ein paar kleinen Unit-Tests bestückt (<a href="http://code-inside.de/blog/2008/05/22/howto-einfache-tests-unittests-oder-keine-angst-vor-unittests/">Einführung in Unit-Tests hier</a>).<br><br>Die Architektur sieht man z.B. auch recht gut in <a href="http://code-inside.de/blog/2008/05/18/mvc-storefront-real-world-application-building-excercise-aspnet-mvc-tdd-more/">Rob Conerys Storefront Projekt</a>.</p> <p><strong>Schichten im Detail: ThreeTier.Data</strong><br><a href="{{BASE_PATH}}/assets/wp-images/image477.png"><img style="border-right: 0px; border-top: 0px; border-left: 0px; border-bottom: 0px" height="148" alt="image" src="{{BASE_PATH}}/assets/wp-images/image-thumb456.png" width="244" border="0"></a>&nbsp;<br>Hier definiere ich erst mal meine Objekte, welche ich im System nutze - simple <a href="http://en.wikipedia.org/wiki/Plain_Old_CLR_Object">POCOs</a>.<br>Zugegeben, man kann sich darüber streiten ob man sein "Model" tatsächlich mit in dem Data-Projekt haben möchte. Da allerdings alles meistens mit irgendwelchen Daten zusammenhängt, passt das schon.<br>Wir haben hier nur die User Klasse:</p> <p><a href="{{BASE_PATH}}/assets/wp-images/image478.png"><img style="border-right: 0px; border-top: 0px; border-left: 0px; border-bottom: 0px" height="184" alt="image" src="{{BASE_PATH}}/assets/wp-images/image-thumb457.png" width="187" border="0"></a>&nbsp;<br>Im Ordern "DataAccess" liegt unsere Schnittstellen (<a href="http://code-inside.de/blog/2007/11/28/howto-interfacesschnittstellen-verstehen-mal-auf-simple-art-und-weise/">Einführung zu Schnittstellen</a>) zu den Datenquellen.<br>In diesem Fall haben wir nur die Schnittstelle "IUserRepository" (Repository zu dt. sowas wie Lager, Speicherort etc.) - dort definieren wir, welche Operationen ich generell auf eine X-beliebige Datenquelle ich ausführen möchte:<br><a href="{{BASE_PATH}}/assets/wp-images/image479.png"><img style="border-right: 0px; border-top: 0px; border-left: 0px; border-bottom: 0px" height="289" alt="image" src="{{BASE_PATH}}/assets/wp-images/image-thumb458.png" width="179" border="0"></a> <br>Das "DemoUserRepository" ist die konkrete Implementierung dieser Schnittstelle. Da ich keine DB oder ähnliches wollte, werden hier statische Daten zurückgegeben.</p> <p><strong>Welchen Vorteil bringt mir jetzt das Interface?<br></strong>Das Interface könnte man hier in Frage stellen, allerdings erlaubt es später recht einfach die Datenquelle zu wechseln - weil alles auf der Schnittstelle beruht. <br>Da man im Regelfall mit einer DB etc. arbeitet möchte man z.B. in Unit-Tests nicht unbedingt die Datenbank fluten, sondern kann sich hier statische Testdaten zurückgegeben lassen. Einfach durch die Schnittstelle.<br>So könnte man auch leichter von einem "Showcase" zu einer echten Implementierung umschwenken.<br><br>Da ich in meinem Beispiel aber nur statische Daten zurückgebe, habe ich im Unit-Tests genau diese getestet. <br><br><strong>Schichten im Detail: ThreeTier.Service</strong></p> <p><a href="{{BASE_PATH}}/assets/wp-images/image480.png"><img style="border-right: 0px; border-top: 0px; border-left: 0px; border-bottom: 0px" height="137" alt="image" src="{{BASE_PATH}}/assets/wp-images/image-thumb459.png" width="210" border="0"></a> <br>Im Service haben wir nach dem gleichen Prinzip auch eine Schnittstelle für unseren "UserService" erstellt.</p> <p><a href="{{BASE_PATH}}/assets/wp-images/image481.png"><img style="border-right: 0px; border-top: 0px; border-left: 0px; border-bottom: 0px" height="280" alt="image" src="{{BASE_PATH}}/assets/wp-images/image-thumb460.png" width="187" border="0"></a></p> <p>In unserem UserService gibt es einmal eine Login-Methode und eine Methode, welche (ganz im Sinne von Social Networking) die Freunde von einem User zurück gibt. Hierbei habe ich zudem auch nur statische Daten genommen. Das ganze basiert allerdings auf dem "UserRepository".</p> <p><strong>Schichten im Detail: ThreeTier.ConsoleApp<br><a href="{{BASE_PATH}}/assets/wp-images/image482.png"><img style="border-right: 0px; border-top: 0px; border-left: 0px; border-bottom: 0px" height="78" alt="image" src="{{BASE_PATH}}/assets/wp-images/image-thumb461.png" width="177" border="0"></a> </strong></p> <p>Mal wieder ein Konsolenprogramm - zwar ist das keine schöne Oberfläche, aber für das Beispiel soll es genügen:</p> <div class="wlWriterSmartContent" id="scid:812469c5-0cb0-4c63-8c15-c81123a09de7:36a76c4c-5da9-4350-9e9f-7066e89cf3f2" style="padding-right: 0px; display: inline; padding-left: 0px; float: none; padding-bottom: 0px; margin: 0px; padding-top: 0px"><pre name="code" class="c#">        static void Main(string[] args)
        {
            Console.WriteLine("Great Social Community System - Please Login...");
            Console.Write("Name: ");
            string loginname = Console.ReadLine();
            Console.Write("PW: ");
            string password = Console.ReadLine();

            IUserService srv = new DemoUserService();

            if (srv.Login(loginname, password))
            {
                Console.WriteLine("Hello: " + loginname);
                Console.WriteLine("Your demo friend collection in the system: ");
                List&lt;User&gt; friends = srv.GetFriendsFromUser(loginname).ToList();

                foreach (User friend in friends)
                {
                    Console.WriteLine(" + " + friend.Login + " - Id: " + friend.Id);
                }
            }
            else
            {
                Console.WriteLine("Login failed");
            }

            Console.ReadLine();
        }</pre></div>
<p><strong>Ausgabe:</strong></p>
<p><a href="{{BASE_PATH}}/assets/wp-images/image483.png"><img style="border-right: 0px; border-top: 0px; border-left: 0px; border-bottom: 0px" height="107" alt="image" src="{{BASE_PATH}}/assets/wp-images/image-thumb462.png" width="410" border="0"></a>&nbsp;<br></p>
<p><strong>Extras: Unit-Tests</strong></p>
<p>Um ein gutes Beispiel zu geben, habe ich sogar 6 Unit-Tests geschrieben. Das Frontend hab ich allerdings nicht getestet ;)<br><a href="{{BASE_PATH}}/assets/wp-images/image484.png"><img style="border-right: 0px; border-top: 0px; border-left: 0px; border-bottom: 0px" height="142" alt="image" src="{{BASE_PATH}}/assets/wp-images/image-thumb463.png" width="349" border="0"></a> </p>
<p>Code-Coverage: 97% (Data + Service)<br><a href="{{BASE_PATH}}/assets/wp-images/image485.png"><img style="border-right: 0px; border-top: 0px; border-left: 0px; border-bottom: 0px" height="59" alt="image" src="{{BASE_PATH}}/assets/wp-images/image-thumb464.png" width="474" border="0"></a> </p>
<p><strong>Resultat:</strong></p>
<p>Durch die 3-Schichtige Architektur ist es später leichter Möglich neue Features einzubauen und die Applikation zu Warten. Im Team macht sich das auch recht gut, da man dadurch eine bessere Teamaufteilung machen kann.</p>
<p><strong><a href="http://{{BASE_PATH}}/assets/files/democode/threetier/threetier.zip">[ Download Source Code ]</a></strong></p>
<p><strong>Video:</strong></p>
<object width="425" height="344"><param name="movie" value="http://www.youtube.com/v/27yknlB8xeg&hl=de&fs=1"></param><param name="allowFullScreen" value="true"></param><embed src="http://www.youtube.com/v/27yknlB8xeg&hl=de&fs=1" type="application/x-shockwave-flash" allowfullscreen="true" width="425" height="344"></embed></object>
