---
layout: post
title: "NuGet Package Restore & Build Server wie z.B. AppVeyor"
date: 2014-07-23 20:51
author: robert.muehsig
comments: true
categories: [HowTo]
tags: [AppVeyor, GitHub, HowTo, NuGet, Package Restore]
---
{% include JB/setup %}
<p><a href="https://www.nuget.org/">NuGet</a> ist ja mittlerweile weit verbreitet, aber eine Frage stellt sich natürlich immer noch: Checkt man die NuGet Packages ein oder nicht? </p> <p>In meinem kleinen Side-Projekt, welches auf <a href="https://github.com/code-inside/web">GitHub</a> liegt und ich über <a href="https://ci.appveyor.com/project/robertmuehsig/code-inside-web">AppVeyor</a> auch bauen lasse nutze ich das <strong>Package Restore Feature</strong> von NuGet, d.h. in meinem Repository befindet sich kein NuGet Package mehr, sondern es wird vor dem Bauen geprüft ob das Package da ist und wenn nicht wird es runtergeladen.</p> <p>Die “eincheck”-Variante hat auch seine Vorteile, aber in meinem Setting hier ist dies unnötig, da ich ohnehin auf diverse andere Dienste vertraue. Also zur Sache:</p> <h3>“Enable NuGet Package Restore” &amp; Fertig, oder?</h3> <p><strong>Nein.</strong></p> <p>Diese Option die aktuell noch im NuGet Tooling drin ist braucht es nicht mehr:</p> <p><a href="{{BASE_PATH}}/assets/wp-images/image2035.png"><img title="image" style="border-top: 0px; border-right: 0px; border-bottom: 0px; border-left: 0px; display: inline" border="0" alt="image" src="{{BASE_PATH}}/assets/wp-images/image_thumb1171.png" width="570" height="314"></a> </p> <p><strong>Diese Option benötigt es nicht mehr!</strong> Mehr dazu in diesem Blogpost “<a href="http://blog.davidebbo.com/2014/01/the-right-way-to-restore-nuget-packages.html">The right way to restore NuGet packages</a>”. Um es kurz zu machen: Im Visual Studio passiert dies “automatisch” – es benötigt nicht diese Magic.</p> <h3>Änderung seit NuGet 2.7</h3> <p>Diese Änderung wurde in <a href="http://blogs.msdn.com/b/dotnet/archive/2013/08/12/improved-package-restore.aspx">NuGet 2.7 gemacht</a>. In dem Blogpost ist auch beschrieben wie man seine Projekte wieder davon befreien kann.</p> <h3>Und was ist nun mit den Buildservern?</h3> <p>Auf dem Buildserver (AppVeyor in meinem Beispiel) kam immer diese Fehlermeldung:</p> <p><em>“C:\projects\code-inside-web\CodeInside.Web\CodeInside.Web.csproj(338,5): error : The build restored NuGet packages. Build the project again to include these packages in the build. For more information, see </em><a href="http://go.microsoft.com/fwlink/?LinkID=317568"><em>http://go.microsoft.com/fwlink/?LinkID=317568</em></a><em>.”</em></p> <p>Der Link zeigt auch wieder auf den MSDN Blog. </p> <h3>Der Fix für das Problem auf dem Buildserver</h3> <p>Generell muss man aktuell noch manuell den “<strong>nuget restore</strong>” Command aufrufen. Im Falle von AppVeyor macht man dies einfach (<a href="http://www.appveyor.com/docs/nuget#visual-studio-nuget-restore" title="Doku">Doku</a>)so:</p> <p><a href="{{BASE_PATH}}/assets/wp-images/image2036.png"><img title="image" style="border-top: 0px; border-right: 0px; border-bottom: 0px; border-left: 0px; display: inline" border="0" alt="image" src="{{BASE_PATH}}/assets/wp-images/image_thumb1172.png" width="570" height="489"></a> </p> <p>Damit sollte es wieder klappen.</p> <p><a href="{{BASE_PATH}}/assets/wp-images/image2037.png"><img title="image" style="border-top: 0px; border-right: 0px; border-bottom: 0px; border-left: 0px; display: inline" border="0" alt="image" src="{{BASE_PATH}}/assets/wp-images/image_thumb1173.png" width="570" height="306"></a></p>
