---
layout: post
title: "Wie finde ich heraus ob mein ADFS 2.0 funktioniert?"
date: 2013-04-23 22:10
author: robert.muehsig
comments: true
categories: [DevOps, HowTo]
tags: [ADFS, Auth, DevOps, HowTo]
language: de
---
{% include JB/setup %}
<p>Ich hatte mich recht lange mti dem Thema <a href="http://technet.microsoft.com/en-us/library/adfs2(v=ws.10).aspx">ADFS 2.0 (“Active Directory Federation Services”)</a> beschäftigt und da kam die recht einfache Frage auf: Wie stelle ich fest ob die Verbindung zwischen ADFS und AD “funktioniert”? Hier eine simple Variante es zu testen…</p> <h3>Was ist ein ADFS überhaupt?</h3> <p>Wenn man über AD-Grenzen hinweg “Vertrauensstellungen” braucht, dann nimmt man in der Microsoft Welt die Active Directory Services. Diese vermitteln zwischen Sender (eigenes Unternehmens-AD) und Empfänger (ein anderes AD oder ein grosse “Zentrale”, wie z.B. der <a href="http://en.wikipedia.org/wiki/Access_Control_Service">Windows Azure Access Control Service</a>) und stellt für den angemeldeten Benutzer Claims aus. Vermutlich ist das nicht 100% ganz exakt und meine Begrifflichkeiten passen auch nicht 100%, aber im Grunde versteh ich das System so ;)</p> <h3>Wie teste ich nun die Funktionalität des ADFS?</h3> <p>Der ADFS nutzt den IIS um die eigentlichen Endpunkte zu hosten. Es gibt auch eine simple Login-Seite, die jeder Nutzen kann:</p> <p><strong><a href="https://{ADFS-FQDN}/adfs/ls/IdpInitiatedSignon.aspx">https://{ADFS-FQDN}/adfs/ls/IdpInitiatedSignon.aspx</a></strong> <p>Danach erscheint eine simple “Login-Seite” – nach dem Klick auf “Anmelden” sollte sowas zu sehen sein: <p><a href="{{BASE_PATH}}/assets/wp-images/image1830.png"><img title="image" style="border-top: 0px; border-right: 0px; border-bottom: 0px; border-left: 0px; display: inline" border="0" alt="image" src="{{BASE_PATH}}/assets/wp-images/image_thumb983.png" width="558" height="252"></a>  <p>Wenn diese Seite ohne es Nutzernamen / Passworts kam funktioniert die Anmeldung über Kerberos – andernfalls wird NTLM genommen. <p>Falls<strong> alles schief läuft</strong> (oder die Konfigurationsdatenbank “kaputt” ist) sieht man solch eine <strong>Fehlermeldung</strong>: <p><a href="{{BASE_PATH}}/assets/wp-images/image1831.png"><img title="image" style="border-top: 0px; border-right: 0px; border-bottom: 0px; border-left: 0px; display: inline" border="0" alt="image" src="{{BASE_PATH}}/assets/wp-images/image_thumb984.png" width="550" height="225"></a>  <p><strong>Was man damit testen kann:</strong> <p>Damit stellt man erstmal nur sicher, dass die Konfiguration/Verbindung<strong> zwischen ADFS und eigenen AD “funktioniert” – mehr nicht – aber auch hier kann es schon zu Problemen kommen</strong>. Ob nun die “Gegenstelle” funktioniert ist ein anderes Problem. <h3>Ich habe ein ADFS Proxy im Einsatz – was nun?</h3> <p>Im Grunde prüft man erst den “Haupt”-ADFS und später schaut man von einer anderen Maschine, welche nur den Proxy sieht, ob dieser Login klappt. Danach geht es weiter bis hin zum “Kunden”. <p>In diesem Blogpost ist das Vorgehen näher beschrieben (und ich glaub von diesem hab ich auch den Tipp) : <a href="http://www.dagint.com/2011/10/how-to-test-if-adfs-is-functioning/">How to test if ADFS is functioning</a> <h3>Troubleshooting</h3> <p>Ich hatte ein paar Probleme mit dem ADFS, welche leider noch nicht vollständig gelöst wurden, jedoch hab ich ein paar Links noch gefunden, welche vielleicht jemanden weiterhelfen:</p> <p><a href="http://social.technet.microsoft.com/wiki/contents/articles/1600.ad-fs-2-0-how-to-change-the-local-authentication-type.aspx">AD FS 2.0: How to Change the Local Authentication Type</a></p> <p><a href="http://social.technet.microsoft.com/wiki/contents/articles/ad-fs-2-0-how-to-configure-the-spn-serviceprincipalname-for-the-service-account.aspx">AD FS 2.0: How to Configure the SPN (servicePrincipalName) for the Service Account</a></p>
