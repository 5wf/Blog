---
layout: post
title: "HowTo: Windows Services remote installieren"
date: 2010-04-13 00:05
author: robert.muehsig
comments: true
categories: [HowTo]
tags: [Admin, HowTo, remote, Service, Windows]
---
{% include JB/setup %}
<p><a href="{{BASE_PATH}}/assets/wp-images/image944.png"><img style="border-right: 0px; border-top: 0px; margin: 0px 10px 0px 0px; border-left: 0px; border-bottom: 0px" height="142" alt="image" src="{{BASE_PATH}}/assets/wp-images/image_thumb129.png" width="198" align="left" border="0"></a> <a href="http://en.wikipedia.org/wiki/Windows_service">Windows Services</a> (oder auf dt. "Dienste") sind recht praktisch und <a href="http://stackoverflow.com/questions/507674/scheduled-console-app-vs-windows-service-when-is-it-appropriate-to-use-each">ab und an besser als kleine Anwendungen die über den Scheduler</a> gestartet werden. Allerdings gestaltet sich das Deployment eines Windows Services ein wenig komplizierter. Mit dem Windows Boardmittel "<a href="http://technet.microsoft.com/en-us/library/bb490995.aspx">SC.exe</a>" geht es aber sogar remote.</p><!--more--> <p><strong>Service Control - sc.exe</strong></p> <p>Diese Anwendung befindet sich im System32 Verzeichnis von Windows (typischerweise: C:\Windows\System32\sc.exe) und scheint von Windows XP bis Windows 7 dabei zu sein.</p> <p><strong>Was kann diese Tool?</strong></p> <p>Mit purem Halbwissen (ich kenn das Tool jetzt 0,5 Tage ;) ) kann man Windows Service damit <a href="http://technet.microsoft.com/en-us/library/bb490995.aspx">verwalten</a> (anlegen, bearbeiten, löschen, starten, stoppen, abfragen...). Das ganze geht von der Kommandozeile und sogar <strong>remote</strong>.</p> <p>z.B. um einen Dienst namens "NewService" auf dem Rechner "myserver" anzulegen:</p> <p> <div class="wlWriterSmartContent" id="scid:812469c5-0cb0-4c63-8c15-c81123a09de7:4ee554f6-42bd-4651-b379-ac7acdccb094" style="padding-right: 0px; display: inline; padding-left: 0px; float: none; padding-bottom: 0px; margin: 0px; padding-top: 0px"><pre name="code" class="c#">sc \\myserver create NewService binpath= c:\windows\system32\NewServ.exe </pre></div></p>
<p><strong>[SC] OpenSCManager FAILED 5: Access is denied.</strong>
<p>Wenn man der Zielrechner nicht in derselben Domäne ist oder die Credentials auf dem System anders sind, wird diesen Fehler bekommen. <a href="http://serverfault.com/questions/19382/why-sc-query-fails-from-one-machine-but-works-from-another">Abhilfe schafft ein "net use" vorher</a>:</p>
<div class="wlWriterSmartContent" id="scid:812469c5-0cb0-4c63-8c15-c81123a09de7:0fcdf0dc-63ce-4686-8576-09bdde25aa9b" style="padding-right: 0px; display: inline; padding-left: 0px; float: none; padding-bottom: 0px; margin: 0px; padding-top: 0px"><pre name="code" class="c#">NET USE \\PRODSRV\IPC$ /USER:&lt;username you logon to PRODSRV with&gt; &lt;password you use on PRODSRV&gt;</pre></div>
<p><strong>Wofür brauch ich das?</strong>
<p>Im Zusammenhang mit unseren <a href="http://code-inside.de/blog/2010/03/19/howtocode-builddeploymentwtf-oder-auch-automatisierung-mit-msbuild/">Automatisierungsbestrebungen mit dem TFS und MSBuild</a> wollen wir auf unserer Entwicklungsplattform auch die Windows Services per Klick deployen - das ganze am besten auch noch einmal am Abend vollautomatisch -&gt; "Nightly Build &amp; Deploy"
<p>Das NET USE und den SC Command werden im AfterBuild unseres MSBuild Scriptsausgeführt und dann wird der Dienst auf der Entwicklungsmaschine gestoppt, die neuen DLLs werden kopiert und wieder gestartet. Easy :)
<p><strong>Powershell?</strong>
<p>Ich hab mich ehrlich gesagt bisher noch nicht an die Powershell rangewagt (bzw. sind solche "Admin" Aufgaben von mir täglich zu erledigen), aber wenn jemand spontan weiß, wie man das cool mit der Powershell machen kann, dann bin ich natürlich dafür ganz offen :)</p>
